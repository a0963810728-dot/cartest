<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8" />
  <title>天堂｜怪物掉落查詢</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <style>
    body {
      margin: 0;
      background: #0b0b0b url("https://www.transparenttextures.com/patterns/dark-stone.png");
      font-family: "Noto Serif TC", "Microsoft JhengHei", serif;
      color: #e5e5e5;
    }

    .container {
      max-width: 900px;
      margin: 40px auto;
      padding: 20px;
      background: rgba(20, 20, 20, 0.92);
      border: 2px solid #3a2f1a;
      box-shadow: 0 0 25px #000;
    }

    h1 {
      text-align: center;
      color: #f5d27a;
      letter-spacing: 4px;
      margin-bottom: 10px;
    }

    .subtitle {
      text-align: center;
      color: #bfae70;
      margin-bottom: 25px;
      font-size: 14px;
    }

    .search-box {
      display: flex;
      justify-content: center;
      gap: 10px;
      margin-bottom: 25px;
    }

    input {
      width: 60%;
      padding: 10px;
      background: #111;
      border: 1px solid #5a4a2a;
      color: #f5f5f5;
      font-size: 16px;
      outline: none;
    }

    button {
      padding: 10px 20px;
      background: linear-gradient(#c9a74d, #7c5a1d);
      border: 1px solid #3a2f1a;
      color: #000;
      font-weight: bold;
      cursor: pointer;
    }

    button:hover {
      filter: brightness(1.1);
    }

    table {
      width: 100%;
      border-collapse: collapse;
      background: #111;
    }

    thead {
      background: #1c1c1c;
    }

    th, td {
      padding: 12px;
      border-bottom: 1px solid #2a2a2a;
    }

    th {
      color: #c9b27c;
      font-size: 14px;
      letter-spacing: 2px;
    }

    tr:nth-child(even) {
      background: #0e0e0e;
    }

    .empty {
      text-align: center;
      padding: 25px;
      color: #9a9a9a;
    }

    /* 掉落率顏色 */
    .rate-common { color: #22c55e; }   /* 綠 */
    .rate-normal { color: #3b82f6; }   /* 藍 */
    .rate-rare   { color: #a855f7; }   /* 紫 */
    .rate-epic   { color: #ef4444; }   /* 紅 */

    @media (max-width: 600px) {
      input { width: 100%; }
      .search-box { flex-direction: column; }
    }
  </style>
</head>

<body>
  <div class="container">
    <h1>天堂・怪物掉落查詢</h1>
    <div class="subtitle">輸入怪物名稱（例：梅杜莎、邪惡蜥蜴）</div>

    <div class="search-box">
      <input id="keyword" placeholder="請輸入怪物名稱…" />
      <button onclick="search()">查詢</button>
    </div>

    <table>
      <thead>
        <tr>
          <th>怪物</th>
          <th>掉落率</th>
        </tr>
      </thead>
      <tbody id="result">
        <tr>
          <td colspan="2" class="empty">請輸入怪物名稱進行查詢</td>
        </tr>
      </tbody>
    </table>
  </div>

<script>
async function search() {
  const q = document.getElementById("keyword").value.trim();
  const tbody = document.getElementById("result");

  if (!q) {
    tbody.innerHTML = '<tr><td colspan="2" class="empty">請輸入怪物名稱</td></tr>';
    return;
  }

  tbody.innerHTML = '<tr><td colspan="2" class="empty">查詢中…</td></tr>';

  try {
    const res = await fetch(`/api/search?q=${encodeURIComponent(q)}`);
    const data = await res.json();

    if (!data.success || !data.results.length) {
      tbody.innerHTML = '<tr><td colspan="2" class="empty">查無資料</td></tr>';
      return;
    }

    tbody.innerHTML = data.results.map(r => {
      const rateNum = Number(r.rate) || 0;
      const percent = rateNum / 10000;

      let cls = "rate-common";
      if (percent < 0.001) cls = "rate-epic";
      else if (percent < 0.01) cls = "rate-rare";
      else if (percent < 0.05) cls = "rate-normal";

      const display = percent === 0 ? "0%" : percent + "%";

      return `
        <tr>
          <td>${r.monster}</td>
          <td class="${cls}">${display}</td>
        </tr>
      `;
    }).join("");

  } catch (e) {
    tbody.innerHTML = '<tr><td colspan="2" class="empty">系統錯誤，請稍後再試</td></tr>';
  }
}
</script>

</body>
</html>
